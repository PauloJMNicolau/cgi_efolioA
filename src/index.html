<!DOCTYPE html>
<html>  
    <head>  
        <meta charset="utf-8" />  
        <title>Efolio A - Computacao Grafica</title>    
        <link href="css/styles.css" rel="stylesheet" />    
        <link rel="shortcut icon" type="image/jpg" href="favicon.png"/> 
        <link rel="icon" type="image/png" sizes="32x32" href="favicon.png"/>   
    </head>  
    <body>
        <div id="formulario">
            <label for="coordenadas">Coordenadas:</label>
            <input type="text" id="coordenadas" name="coordenadas">
            <br />
            <button type="button" onclick="desenhar()" >Desenhar</button>
            <button type="button" onclick="apagar()">Apagar Retas</button>
            <button type="button" onclick="mudarVista()" id="vista">3D</button>
    </body>
    <script type="text/javascript" src="js/three.js"></script>
    <script type="text/javascript" src="js/lineMP.js"></script>   
    <!-- Código Javascript que executa as funções solicitadas -->    
    <script type="text/javascript">  

        //Variaveis da Cena
        let fatPixelSize = 6;                                               //Tamanho do Pixel "Gordo"
        let centerRef = [0,0,0];                                            //Ponto de Referencial dos eixos
        let limite = 21*fatPixelSize;                                       //Limite maximo dos eixos
        let cena= {};                                                       //Variavel para a cena
        let camera;                                                         //Variavel para a camera
        let renderer = {};                                                  //Variavel para o Renderer
        let planoSize = 301;                                                //Tamanho do Plano                                     
        let light = {}                                                      //Luz para se perceber a diferença de faces no 3D
        let rato = {x:0, y:0, z:1};

        //Criar a Cena
        function createScene(){
            cena = new THREE.Scene();                                                 //Criar a cena
            //Render da Imagem
            renderer = new THREE.WebGLRenderer();                                     //Criar o Renderer
            renderer.setSize(window.innerWidth, window.innerHeight);                  //Definir Tamanho do Renderer
            document.body.appendChild(renderer.domElement);                           //Adicionar na página HTML o elemento
        } 

        //Criar o plano
        function createPlane(){
            const planoGeometria = new THREE.PlaneGeometry(planoSize,planoSize);            //Geometria do Plano
            const planoMaterial = new THREE.MeshBasicMaterial(                              //Propriedades do plano
                {
                    color: 0xA8B5FF,
                    side: THREE.FrontSide
                }
            )
            const plano = new THREE.Mesh(planoGeometria, planoMaterial);                    //Cria o plano
            plano.position.x=0;                                                             //posicionando o plano em posição inicial
            plano.position.y=0;                                                             //de modo a começar junto dos eixos 
            plano.name="Plano 2D";                                                          //Definir nome para o plano
            cena.add(plano);                                                                //e adiciona na cena
        }
        
        //Criar Eixos
        function createEixos(){
            const eixoMaterial = new THREE.LineBasicMaterial(                               //Propriedades dos eixos
                {
                    color:0xf53100
                }
            );
            const eixoPontosX = [];                                                                                     //Pontos dos eixos
            const eixoPontosY = [];                                                                                     //x e y
            eixoPontosY.push( new THREE.Vector3(centerRef[0], centerRef[1]+limite+5, centerRef[2]+2*fatPixelSize+1));   //Cria Ponto Limite superior de Y
            eixoPontosY.push( new THREE.Vector3(centerRef[0], centerRef[1]-limite-5, centerRef[2]+2*fatPixelSize+1));   //cria ponto limite inferior de Y
            eixoPontosX.push( new THREE.Vector3(centerRef[0]-limite-5, centerRef[1], centerRef[2]+2*fatPixelSize+1));   //Cria Ponto Limite Inferior de X
            eixoPontosX.push( new THREE.Vector3(centerRef[0]+limite+5, centerRef[1], centerRef[2]+2*fatPixelSize+1));   //Cria Ponto Limite Superior de X
            const eixoGeometriaX = new THREE.BufferGeometry().setFromPoints(eixoPontosX);                               //Geometria dos Eixos
            const eixoGeometriaY = new THREE.BufferGeometry().setFromPoints(eixoPontosY);                               //Geometria dos Eixos
            const eixoX = new THREE.Line(eixoGeometriaX, eixoMaterial);                                                 //Cria Eixos 
            const eixoY = new THREE.Line(eixoGeometriaY, eixoMaterial);                                                 //x e y
            cena.add(eixoX);                                                                                            //Adiciona na cena os eixos
            cena.add(eixoY);
        }
        
        //Criar Grelha
        function createGrid(){
            const grelhaMaterial = new THREE.LineBasicMaterial(                                                         //Propriedades das linhas da grelha
                {
                    color: 0x001068
                }
            );
            let posicoesGrelha = [];                                                                                    //Posições das linhas da grelha
            //Criar as posições das linhas de grelha
            for(let i = 0 + fatPixelSize/2; i <= limite; i=i+fatPixelSize){
                posicoesGrelha.push(i);                                                                                 //Gerar as diferentes posições para as linhas
            }
            //Gerar Linhas Verticais
            for(let i = 0; i< posicoesGrelha.length; i++){                                                              //Quadrantes Positivos
                const grelha = [];                                                                                      //Pontos das linhas da grelha
                grelha.push(new THREE.Vector3(centerRef[0]+posicoesGrelha[i], centerRef[1]+limite, centerRef[2]+1));    //Criar ponto 
                grelha.push(new THREE.Vector3(centerRef[0]+posicoesGrelha[i], centerRef[1]-limite, centerRef[2]+1));    //Criar ponto final
                let grelhaGeometria = new THREE.BufferGeometry().setFromPoints(grelha);                                 //Gerar geometria da linha
                let grelhaPixel = new THREE.Line(grelhaGeometria, grelhaMaterial);                                      //Gerar Linha vertical
                cena.add(grelhaPixel);                                                                                  //Adicionar linha na cena
            }
            for(let i = 0; i< posicoesGrelha.length; i++){                                                              //Quadrantes Negativos
                const grelha = [];                                                                                      //Pontos das linhas da grelha
                grelha.push(new THREE.Vector3(centerRef[0]-posicoesGrelha[i], centerRef[1]+limite, centerRef[2]+1));    //Criar ponto 
                grelha.push(new THREE.Vector3(centerRef[0]-posicoesGrelha[i], centerRef[1]-limite, centerRef[2]+1));    //Criar ponto final
                let grelhaGeometria = new THREE.BufferGeometry().setFromPoints(grelha);                                 //Gerar geometria da linha
                let grelhaPixel = new THREE.Line(grelhaGeometria, grelhaMaterial);                                      //Gerar Linha vertical
                cena.add(grelhaPixel);                                                                                  //Adicionar linha na cena
            }
            //Gerar Linhas Horizontais
            for(let i = 0; i< posicoesGrelha.length; i++){                                                              //Quadrantes Positivos
                const grelha = [];                                                                                      //Pontos das linhas da grelha
                grelha.push(new THREE.Vector3(centerRef[0]-limite, posicoesGrelha[i]+centerRef[1], centerRef[2]+1));    //Criar ponto inicial
                grelha.push(new THREE.Vector3(centerRef[0]+limite, posicoesGrelha[i]+centerRef[1], centerRef[2]+1));    //Criar ponto final
                const grelhaGeometria = new THREE.BufferGeometry().setFromPoints(grelha);                               //Gerar geometria da linha
                const grelhaPixel = new THREE.Line(grelhaGeometria, grelhaMaterial);                                    //Gerar linha horizontal
                cena.add(grelhaPixel);                                                                                  //Adicionar linha na cena
            }
            for(let i = 0; i< posicoesGrelha.length; i++){                                                              //Quadrantes Negativos
                const grelha = [];                                                                                      //Pontos das linhas da grelha
                grelha.push(new THREE.Vector3(centerRef[0]-limite, -posicoesGrelha[i]+centerRef[1], centerRef[2]+1));   //Criar ponto inicial
                grelha.push(new THREE.Vector3(centerRef[0]+limite, -posicoesGrelha[i]+centerRef[1], centerRef[2]+1));   //Criar ponto final
                const grelhaGeometria = new THREE.BufferGeometry().setFromPoints(grelha);                               //Gerar geometria da linha
                const grelhaPixel = new THREE.Line(grelhaGeometria, grelhaMaterial);                                    //Gerar linha horizontal
                cena.add(grelhaPixel);                                                                                  //Adicionar linha na cena
            }
        }

        //Criar Camera de Vista 2D
        function createViewport2D(){
            //Criar o ViewPort 2D
            camera = new THREE.OrthographicCamera(window.innerWidth/ -5, window.innerWidth/5, window.innerHeight / 5, window.innerHeight / -5, 1, 2000);
            camera.position.x = 0;                                                              //Posiciona a Camera no eixo x
            camera.position.y = 0;                                                              //Posiciona a Camera no eixo y
            camera.position.z = 50;                                                             //Posiciona a camera no eixo z
            camera.lookAt(cena.position);                                                       //Coloca camera a observar a possição da cena
            camera.name="2D";                                                                   //Atribuir o nome 3D na camera
            cena.add(camera);                                                                   //Adiciona a camera na cena
            // Luz para 2D
            light = new THREE.AmbientLight(0xffffff);                                           //Iliminação para se conseguir ver a cor do material
            light.name = "Luz";                                                                 //Atribuir o nome à iluminação
            cena.add(light);                                                                    //Adicionar na cena
            renderer.render(cena,camera);                                                       //Atualiza a imagem da camera
        }

        //Criar Camera de Vista 3D
        function createViewport3D(){
            //Criar o viewPort 3D
            camera = new THREE.OrthographicCamera(window.innerWidth/ -6, window.innerWidth/6, window.innerHeight / 6, window.innerHeight / -6, 2, 2000);
            camera.position.x = -20;                                                            //Posiciona a Camera no eixo x
            camera.position.y = 15;                                                             //Posiciona a Camera no eixo y
            camera.position.z = 70;                                                             //Posiciona a camera no eixo z
            camera.lookAt(cena.position);                                                       //Coloca camera a observar a possição da cena
            camera.name="3D";                                                                   //Atribuir o nome 3D na camera
            cena.add(camera);                                                                   //Adiciona a camera na cena
            // Luz para 3D
            light = new THREE.HemisphereLight(0xffffff, 0xB12AA0, 1);                           //Iluminação para se conseguir perceber os cubos
            light.name = "Luz";                                                                 //Atribuir o nome à iluminação
            cena.add(light);                                                                    //Adicionar na cena
            renderer.render(cena,camera);                                                       //Atualiza a imagem da camera
        }

        //Função para mudar a vista da câmara
        function mudarVista(){
            light = cena.getObjectByName("Luz");                                            //Procura por existencia de objtos com o nome "Luz"
            if(light)
                cena.remove(light);                                                         //Remove da cena caso existam
            camera = cena.getObjectByName("2D");                                            //Procura por existencia de Vistas 2D
            if(camera){                                                                     //Se existir vista
                cena.remove(camera);                                                        //Remover Camera 2D existente
                createViewport3D();                                                         //Cria Vista 3D
                let bt = document.getElementById("vista");                                  //Procura o Botão de alteração de vista
                bt.innerHTML = "2D";                                                        //e altera o texto para 2D
            } else {                                                                        //Caso não exista vista 2D
                camera = cena.getObjectByName("3D");                                        //Procura por existencia de vista 3D
                if(camera)                                                                  //Se existir vista   
                    cena.remove(camera);                                                    //Remover Camera 3D existente
                createViewport2D();                                                         //Cria vista 2D
                let bt = document.getElementById("vista");                                  //procura o botão de alteração de vista
                bt.innerHTML = "3D";                                                        //e altera o texto para 3D
            }
        }

        //Ler Coordenadas do Formulário
        function desenhar(){
            let texto = document.getElementById("coordenadas").value;              //Ler Conteudo do formulário
            let coord = texto.split(" ");                                          //Dividir o texto em coordenadas
            let x1 = Number(coord[0]);                                             //Definir x1
            let y1 = Number(coord[1]);                                             //Definir y1
            let x2 = Number(coord[2]);                                             //Definir x2
            let y2 = Number(coord[3]);                                             //Definir y2
            let pontos = lineMP([x1,y1],[x2,y2]);                                  //Obter Pontos a desenhar       
            //Desenhar os pontos gerados
            for(let i = 0; i< pontos.length; i++){
                let ponto = pontos[i];                                             //Obter Array das Coordenadas no Array
                let x = ponto[0];                                                  //Definir X com o primeiro valor do Array de Coordenadas
                let y = ponto[1];                                                  //Definir Y com o segundo  valor no array de coordenadas
                x = x*fatPixelSize+centerRef[0];                                   //Calcular as posições x e y
                y = y*fatPixelSize+centerRef[1];                                   //onde o cubo vai ser colocado
                drawPixel(x,y);                                                    //Desenhar o Pixel na cena
                renderer.render(cena,camera);                                      //Atualiza a Cena na camera
            }
        }

        //Desenhar o Pixel nas posiçoes fornecidas
        function drawPixel(x,y){
            const geometriaPixel = new THREE.CubeGeometry(fatPixelSize-1, fatPixelSize-1, fatPixelSize-1);  //Definir Propriedades
            const materialPixel = new THREE.MeshLambertMaterial(                                              //e geometria do cubo
                {
                    color: 0x2C5163
                }
            );
            let pixel = new THREE.Mesh(geometriaPixel, materialPixel);                                      //Criar Cubo
            pixel.position.x=x;                                                                             //Posiciona o cubo em x
            pixel.position.y=y;                                                                             //Posiciona o cubo em y
            pixel.position.z=10;                                                                            //Posiciona o cubo em z
            pixel.name="Pixel";                                                                             //Define o nome "Pixel" para o cubo
            cena.add(pixel);                                                                                //Adicionar Cubo na cena
        }

        //Apagar Cubos das Linhas
        function apagar(){
            let objeto;
            do{
                objeto = cena.getObjectByName("Pixel");                                                 //Pesquisa os elementos com o nome "Pixel"
                if(objeto){                                                                             //Verifica se encontrou objeto
                    cena.remove(objeto);                                                                //Remove objeto da cena
                    objeto.material.dispose();                                                          //e elimina da memoria
                }
            }while(objeto);
            renderer.render(cena,camera);
        }
        
        //Função para aceitar os eventos da tecla para mudar a vista
        document.addEventListener("keydown", teclaPresionada, false);                                       //Verifica se tecla foi presionada
        function teclaPresionada(event){
            let key = event.which;
            switch (key){
                case 77:                                                                                    //Verifica Tecla "M"
                    mudarVista();                                                                           //Altera para a vista alternativa
                    break;
                case 68:                                                                                    //Verifica Tecla "D"
                case 13:                                                                                    //Verifica Tecla "Enter"
                    desenhar();                                                                             //Lê caixa de texto e desenha pontos
                    break;
                case 46:                                                                                    //Verifica Tecla "Delete"
                case 67:                                                                                    //Verifica Tecla "C"
                    apagar();                                                                               //Apaga Linhas
                    break;
            }
        }

        //Definições iniciais da cena
        function init(){
            createScene();                                                                                  //Criar Cena e Renderer
            createPlane();                                                                                  //Criar Plano
            createEixos();                                                                                  //Criar Eixos
            createGrid();                                                                                   //Criar Grelha do plano
            createViewport2D();                                                                             //Inicia programa com vista 2D
        }

        init();

        /*//Função para aceitar os eventos do  rato
        renderer.domElement.addEventListener( 'pointerdown', ratoClicado );
        function ratoClicado(evento){
            evento.preventDefault();  
    console.log(evento.clientX);
    rato.x = ( evento.clientX / (fatPixelSize)-160 )/fatPixelSize;
    rato.y = ( evento.clientX / window.innerWidth ) * 2 -1/fatPixelSize;
    console.log(rato.x, rato.y);
        }*/
    </script>  
</html>