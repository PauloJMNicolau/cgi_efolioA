<!DOCTYPE html>
<html>  
    <head>  
        <meta charset="utf-8" />  
        <title>Efolio A - Computacao Grafica</title>    
        <link href="css/styles.css" rel="stylesheet" />    
        <link rel="shortcut icon" type="image/jpg" href="favicon.ico"/>    
    </head>  
    <body>
        <div id="formulario">
            <label for="coordenadas">Coordenadas:</label>
            <input type="text" id="coordenadas" name="coordenadas">
            <br />
            <button type="button" onclick="desenhar()" >Desenhar</button>
            <button type="button" onclick="apagar()">Apagar Retas</button>
            <button type="button" onclick="mudarVista()" id="vista">3D</button>
    </body>
    <script type="text/javascript" src="js/three.js"></script>
    <script type="text/javascript" src="js/lineMP.js"></script>   
    <!-- Código Javascript que executa as funções solicitadas -->    
    <script type="text/javascript">  

        //Criar a Cena
        const cena = new THREE.Scene();                                                 //Criar a cena
        let camera;

        //Render da Imagem
        const renderer = new THREE.WebGLRenderer();                                     //Criar o Renderer
        renderer.setSize(window.innerWidth, window.innerHeight);                        //Definir Tamanho do Renderer
        document.body.appendChild(renderer.domElement);                                 //Adicionar na página HTML o elemento

        //Definições iniciais da cena

        var light = new THREE.AmbientLight( 0x000033 ); // soft white light
cena.add( light );

        //Criar o plano
        const planoGeometria = new THREE.PlaneGeometry(300,300);                        //Geometria do Plano
        const planoMaterial = new THREE.MeshBasicMaterial(                              //Propriedades do plano
            {
                color: 0x76605A,
                side: THREE.FrontSide
            }
        )
        const plano = new THREE.Mesh(planoGeometria, planoMaterial);                    //Cria o plano
        plano.position.x=0;                                                             //posicionando o plano em posição inicial
        plano.position.y=0;                                                             //de modo a começar junto dos eixos 
        plano.name="Plano 2D";                                                          //Definir nome para o plano
        cena.add(plano);                                                                //e adiciona na cena

        //Variaveis da Cena
        let fatPixelSize = 6;                                                           //Tamanho do Pixel "Gordo"
        let centerRef = [-130,-130,0];                                                  //Ponto de Referencial dos eixos
        let limite = 125;                                                               //Limite maximo dos eixos

        //Criar Eixos
        const eixoMaterial = new THREE.LineBasicMaterial(                               //Propriedades dos eixos
            {
                color:0xf53100
            }
        );
        const eixoPontos = [];                                                                  //Pontos dos eixos
        eixoPontos.push( new THREE.Vector3(centerRef[0], limite, centerRef[2]+1));                //Cria Ponto Limite de Y
        eixoPontos.push( new THREE.Vector3(centerRef[0], centerRef[1], centerRef[2]+1));          //Cria Ponto de Origem XY
        eixoPontos.push( new THREE.Vector3(limite, centerRef[1], centerRef[2]+1));                //Cria Ponto Limite de X
        const eixoGeometria = new THREE.BufferGeometry().setFromPoints(eixoPontos);             //Geometria dos Eixos
        const eixos = new THREE.Line(eixoGeometria, eixoMaterial);                              //Cria Eixos 
        cena.add(eixos);                                                                        //Adiciona na cena os eixos

        //Criar Grelha
        const grelhaMaterial = new THREE.LineBasicMaterial(                                     //Propriedades das linhas da grelha
            {
                color: 0xf5be00
            }
        );
        let posicoesGrelha = [];                                                                //Posições das linhas da grelha
        //Criar as posições das linhas de grelha
        for(let i = centerRef[0] + fatPixelSize; i <= limite; i=i+fatPixelSize){
            posicoesGrelha.push(i);                                                             //Gerar as diferentes posições para as linhas
        }
        //Gerar Linhas Verticais
        for(let i = 0; i< posicoesGrelha.length; i++){
            const grelha = [];                                                                  //Pontos das linhas da grelha
            grelha.push(new THREE.Vector3(posicoesGrelha[i], centerRef[1], centerRef[2]+1));      //Criar ponto inicial 
            grelha.push(new THREE.Vector3(posicoesGrelha[i], limite, centerRef[2]+1));            //Criar ponto final
            const grelhaGeometria = new THREE.BufferGeometry().setFromPoints(grelha);           //Gerar geometria da linha
            const grelhaPixel = new THREE.Line(grelhaGeometria, grelhaMaterial);                //Gerar Linha vertical
            cena.add(grelhaPixel);                                                              //Adicionar linha na cena
        }
        //Gerar Linhas Horizontais
        for(let i = 0; i< posicoesGrelha.length; i++){
            const grelha = [];                                                                  //Pontos das linhas da grelha
            grelha.push(new THREE.Vector3(centerRef[0], posicoesGrelha[i], centerRef[2]+1));      //Criar ponto inicial
            grelha.push(new THREE.Vector3(limite, posicoesGrelha[i], centerRef[2]+1));            //Criar ponto final
            const grelhaGeometria = new THREE.BufferGeometry().setFromPoints(grelha);           //Gerar geometria da linha
            const grelhaPixel = new THREE.Line(grelhaGeometria, grelhaMaterial);                //Gerar linha horizontal
            cena.add(grelhaPixel);                                                              //Adicionar linha na cena
        }

        function createViewport2D(){
            //Criar o ViewPort 2D
            camera = new THREE.OrthographicCamera(window.innerWidth/ -5, window.innerWidth/5, window.innerHeight / 5, window.innerHeight / -5, 1, 2000);
            camera.position.x = 0;                                                            //Posiciona a Camera no eixo x
            camera.position.y = 0;                                                            //Posiciona a Camera no eixo y
            camera.position.z = 50;                                                           //Posiciona a camera no eixo z
            camera.lookAt(cena.position);                                                     //Coloca camera a observar a possição da cena
            camera.name="2D";
            cena.add(camera);                                                                 //Adiciona a camera na cena
            renderer.render(cena,camera);                                                     //Atualiza a imagem da camera
        }

        function createViewport3D(){
            //Criar o viewPort 3D
            camera = new THREE.OrthographicCamera(window.innerWidth/ -6, window.innerWidth/6, window.innerHeight / 6, window.innerHeight / -6, 2, 2000);
            camera.position.x = -20;                                                          //Posiciona a Camera no eixo x
            camera.position.y = 15;                                                          //Posiciona a Camera no eixo y
            camera.position.z = 70;                                                           //Posiciona a camera no eixo z
            camera.lookAt(cena.position);                                                     //Coloca camera a observar a possição da cena
            camera.name="3D";
            cena.add(camera);                                                                 //Adiciona a camera na cena
            renderer.render(cena,camera);                                                     //Atualiza a imagem da camera
        }

        function mudarVista(){
            camera = cena.getObjectByName("2D");
            console.log(camera);
            if(camera){
                //Remover Camera existente
                cena.remove(camera);
                createViewport3D();
                let bt = document.getElementById("vista");
                bt.innerHTML = "2D";
            } else {
                camera = cena.getObjectByName("3D");
                if(camera){
                    //Remover Camera 3D existente
                    cena.remove(camera);
                }
                createViewport2D();
                let bt = document.getElementById("vista");
                bt.innerHTML = "3D";
            }
        }

        //Ler Coordenadas do Formulário
        function desenhar(){
            let texto = document.getElementById("coordenadas").value;                               //Ler Conteudo do formulário
            let coord = texto.split(" ");                                                           //Dividir o texto em coordenadas
            let x1 = Number(coord[0]);                                                              //Definir x1
            let y1 = Number(coord[1]);                                                              //Definir y1
            let x2 = Number(coord[2]);                                                              //Definir x2
            let y2 = Number(coord[3]);                                                              //Definir y2
            let pontos = lineMP([x1,y1],[x2,y2]);                                                   //Obter Pontos a desenhar         
            //Desenhar os pontos gerados
            for(let i = 0; i< pontos.length; i++){
                let ponto = pontos[i];                                                              //Obter Array das Coordenadas no Array
                let x = ponto[0];                                                                   //Definir X com o primeiro valor do Array de Coordenadas
                let y = ponto[1];                                                                   //Definir Y com o segundo  valor no array de coordenadas
                x = x*fatPixelSize+centerRef[0]-(fatPixelSize/2);
                y = y*fatPixelSize+centerRef[1]-(fatPixelSize/2);
                drawPixel(x,y);                                                                   //Desenhar o Pixel na cena
                renderer.render(cena,camera);                                                 //Atualiza a Cena na camera
            }
        }

        //Desenhar o Pixel nas posiçoes fornecidas
        function drawPixel(x,y){
            const geometriaPixel = new THREE.CubeGeometry(fatPixelSize-1, fatPixelSize-1, fatPixelSize-1);    //Definir Propriedades
            const materialPixel = new THREE.MeshBasicMaterial(                                          //e geometria do cubo
                {
                    color: 0x2C5163
                }
            );
            /*const wireGeoPixel = new THREE.CubeGeometry(fatPixelSize, fatPixelSize, fatPixelSize);    //Definir Propriedades
            const wireframePixel = new THREE.MeshBasicMaterial(                                          //e geometria do cubo
                {
                    color: 0x000000,
                    wireframe: true
                    
                }
            );*/
            let pixel = new THREE.Mesh(geometriaPixel, materialPixel);                                  //Criar Cubo
            //let pixelBorda = new THREE.Mesh(wireGeoPixel, wireframePixel);
            pixel.position.x=x;                                                                         //Posiciona o cubo em x
            pixel.position.y=y;                                                                         //Posiciona o cubo em y
            pixel.position.z=10;                                                                        //Posiciona o cubo em z
            pixel.name="Pixel";                                                                         //Define o nome "Pixel" para o cubo
            /*pixelBorda.position.x=x;                                                                         //Posiciona o cubo em x
            pixelBorda.position.y=y;                                                                         //Posiciona o cubo em y
            pixelBorda.position.z=10;                                                                        //Posiciona o cubo em z
            pixelBorda.name="Pixel"; */
            cena.add(pixel);                                                                            //Adicionar Cubo na cena
            //cena.add(pixelBorda);
        }

        //Apagar Cubos das Linhas
        function apagar(){
            let objeto;
            do{
                objeto = cena.getObjectByName("Pixel");                                                 //Pesquisa os elementos com o nome "Pixel"
                if(objeto){                                                                             //Verifica se encontrou objeto
                    cena.remove(objeto);                                                                //Remove objeto da cena
                    objeto.material.dispose();                                                          //e elimina da memoria
                }
            }while(objeto);
            renderer.render(cena,camera);
        }
        
        createViewport2D();

        document.addEventListener("keydown", teclaPresionada, false);

        function teclaPresionada(event){
            let key = event.which;
            if (key == 77){
                mudarVista();
            }
        }

        renderer.render(cena,camera);

    </script>  
</html>